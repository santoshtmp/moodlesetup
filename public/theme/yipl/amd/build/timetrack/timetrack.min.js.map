{"version":3,"file":"timetrack.min.js","sources":["../../src/timetrack/timetrack.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module\n *\n * @copyright 2025 YIPL\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n *\n * https://moodledev.io/docs/guides/javascript/jquery\n * https://moodledev.io/docs/guides/javascript\n *\n */\n\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\n\nconst x_time = 15;\nvar idleTimer = null;\nvar idleStatus = false;\n\nexport const init = (page_data) => {\n    //\n    // on_load_send_pendingDuration();\n    // window.console.log(\"  ::: start :::  \");\n    // call set_duration when go to next link page\n    $(window).on(\"beforeunload\", function () {\n        set_duration(page_data);\n    });\n    // execute\n    idleTimer = setTimeout(function () {\n        set_duration(page_data);\n    }, x_time * 1000);\n\n    //\n    $('*').on('mousemove mouseover click keydown keypress keyup mouseenter scroll resize dblclick',\n        function () {\n            //\n            clearTimeout(idleTimer);\n            if (idleStatus) {\n                idleStatus = false;\n                reset_start_time(page_data);\n            }\n            // if passive or in active in page for x_time seconds\n            idleTimer = setTimeout(function () {\n                set_duration(page_data);\n            }, x_time * 1000);\n        }\n    );\n\n};\n\n/**\n *\n * @param {*} page_data\n */\nfunction set_duration(page_data) {\n    // var duration = parseInt((endTime - startTime) / 1000);// duration in seconds\n    let request = {\n        methodname: 'yipl_timetrack',\n        args: {\n            user_id: parseInt(page_data['user_id']),\n            course_id: parseInt(page_data['course_id']),\n            cmod_id: parseInt(page_data['cmod_id']),\n            option: 1\n        }\n    };\n    let ajax = Ajax.call([request])[0];\n    ajax.done(function (response) {\n        if (response.status) {\n            // window.console.log('time duration save.');\n        } else {\n            // window.console.log('something is wrong during saving user time duration...');\n        }\n    });\n    // ajax.fail(function () {\n    //     window.console.log('failed...');\n    // });\n    // ajax.always(function (response) {\n    //     window.console.log(response);\n    // });\n    //\n    idleStatus = true;\n\n\n}\n\n/**\n *\n * @param {*} page_data\n */\nfunction reset_start_time(page_data) {\n    let request = {\n        methodname: 'yipl_timetrack',\n        args: {\n            user_id: parseInt(page_data['user_id']),\n            course_id: parseInt(page_data['course_id']),\n            cmod_id: parseInt(page_data['cmod_id']),\n            option: 2\n        }\n    };\n    Ajax.call([request]);\n    // let ajax = Ajax.call([request])[0];\n    // ajax.always(function (response) {\n    //     window.console.log(response);\n    // });\n}"],"names":["idleTimer","idleStatus","set_duration","page_data","request","methodname","args","user_id","parseInt","course_id","cmod_id","option","Ajax","call","done","response","status","window","on","setTimeout","x_time","clearTimeout","reset_start_time"],"mappings":";;;;;;;;;;kKA8BIA,UAAY,KACZC,YAAa,WAqCRC,aAAaC,eAEdC,QAAU,CACVC,WAAY,iBACZC,KAAM,CACFC,QAASC,SAASL,UAAS,SAC3BM,UAAWD,SAASL,UAAS,WAC7BO,QAASF,SAASL,UAAS,SAC3BQ,OAAQ,IAGLC,cAAKC,KAAK,CAACT,UAAU,GAC3BU,MAAK,SAAUC,UACZA,SAASC,UAajBf,YAAa,gBA7DIE,gCAKfc,QAAQC,GAAG,gBAAgB,WACzBhB,aAAaC,cAGjBH,UAAYmB,YAAW,WACnBjB,aAAaC,aACdiB,0BAGD,KAAKF,GAAG,sFACN,WAEIG,aAAarB,WACTC,aACAA,YAAa,WAmDHE,eAClBC,QAAU,CACVC,WAAY,iBACZC,KAAM,CACFC,QAASC,SAASL,UAAS,SAC3BM,UAAWD,SAASL,UAAS,WAC7BO,QAASF,SAASL,UAAS,SAC3BQ,OAAQ,kBAGXE,KAAK,CAACT,UA5DCkB,CAAiBnB,YAGrBH,UAAYmB,YAAW,WACnBjB,aAAaC,aACdiB"}