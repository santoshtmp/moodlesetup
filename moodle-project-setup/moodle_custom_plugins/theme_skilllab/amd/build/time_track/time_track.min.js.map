{"version":3,"file":"time_track.min.js","sources":["../../src/time_track/time_track.js"],"sourcesContent":["/**\n * https://moodledev.io/docs/guides/javascript/jquery\n * https://moodledev.io/docs/guides/javascript\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\n\nconst x_time = 15;\nvar idleTimer = null;\nvar idleStatus = false;\n\nexport const init = (page_data) => {\n    //\n    // on_load_send_pendingDuration();\n    // window.console.log(\"  ::: start :::  \");\n    // call set_duration when go to next link page\n    $(window).on(\"beforeunload\", function () {\n        set_duration(page_data);\n    });\n    // execute\n    idleTimer = setTimeout(function () {\n        set_duration(page_data);\n    }, x_time * 1000);\n\n    //\n    $('*').on('mousemove mouseover click keydown keypress keyup mouseenter scroll resize dblclick',\n        function () {\n            //\n            clearTimeout(idleTimer);\n            if (idleStatus) {\n                idleStatus = false;\n                reset_start_time(page_data);\n            }\n            // if passive or in active in page for x_time seconds\n            idleTimer = setTimeout(function () {\n                set_duration(page_data);\n            }, x_time * 1000);\n        }\n    );\n\n};\n\n/**\n *\n * @param {*} page_data\n */\nfunction set_duration(page_data) {\n    // var duration = parseInt((endTime - startTime) / 1000);// duration in seconds\n    let request = {\n        methodname: 'skilllab_time_track',\n        args: {\n            user_id: parseInt(page_data['user_id']),\n            course_id: parseInt(page_data['course_id']),\n            cmod_id: parseInt(page_data['cmod_id'])\n        }\n    };\n    let ajax = Ajax.call([request])[0];\n    ajax.done(function (response) {\n        if (response.status) {\n            // window.console.log('time duration save.');\n        } else {\n            // window.console.log('something is wrong during saving user time duration...');\n        }\n    });\n    // ajax.fail(function () {\n    //     window.console.log('failed...');\n    // });\n    // ajax.always(function (response) {\n    //     window.console.log(response);\n    // });\n    //\n    idleStatus = true;\n\n\n}\n\n/**\n *\n * @param {*} page_data\n */\nfunction reset_start_time(page_data) {\n    let request = {\n        methodname: 'skilllab_time_track_reset_start_time',\n        args: {\n            user_id: parseInt(page_data['user_id']),\n            course_id: parseInt(page_data['course_id']),\n            cmod_id: parseInt(page_data['cmod_id'])\n        }\n    };\n    Ajax.call([request]);\n    // let ajax = Ajax.call([request])[0];\n    // ajax.always(function (response) {\n    //     window.console.log(response);\n    // });\n}\n\n// /**\n//  *\n//  */\n// function on_load_send_pendingDuration() {\n//     // On page load, process any pending data\n//     $(window).on(\"load\", function () {\n//         const pendingData = localStorage.getItem('pendingDuration');\n//         if (pendingData) {\n//             const data = JSON.parse(pendingData);\n//             Ajax.call([{\n//                 methodname: 'skilllab_time_track',\n//                 args: data\n//             }]);\n//             localStorage.removeItem('pendingDuration');\n//         }\n//     });\n// }"],"names":["idleTimer","idleStatus","set_duration","page_data","request","methodname","args","user_id","parseInt","course_id","cmod_id","Ajax","call","done","response","status","window","on","setTimeout","x_time","clearTimeout","reset_start_time"],"mappings":";;;;;kKAUIA,UAAY,KACZC,YAAa,WAqCRC,aAAaC,eAEdC,QAAU,CACVC,WAAY,sBACZC,KAAM,CACFC,QAASC,SAASL,UAAS,SAC3BM,UAAWD,SAASL,UAAS,WAC7BO,QAASF,SAASL,UAAS,WAGxBQ,cAAKC,KAAK,CAACR,UAAU,GAC3BS,MAAK,SAAUC,UACZA,SAASC,UAajBd,YAAa,gBA5DIE,gCAKfa,QAAQC,GAAG,gBAAgB,WACzBf,aAAaC,cAGjBH,UAAYkB,YAAW,WACnBhB,aAAaC,aACdgB,0BAGD,KAAKF,GAAG,sFACN,WAEIG,aAAapB,WACTC,aACAA,YAAa,WAkDHE,eAClBC,QAAU,CACVC,WAAY,uCACZC,KAAM,CACFC,QAASC,SAASL,UAAS,SAC3BM,UAAWD,SAASL,UAAS,WAC7BO,QAASF,SAASL,UAAS,yBAG9BS,KAAK,CAACR,UA1DCiB,CAAiBlB,YAGrBH,UAAYkB,YAAW,WACnBhB,aAAaC,aACdgB"}