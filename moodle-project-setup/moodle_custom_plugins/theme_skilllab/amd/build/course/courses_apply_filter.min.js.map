{"version":3,"file":"courses_apply_filter.min.js","sources":["../../src/course/courses_apply_filter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module\n *\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'],\n    function ($) {\n        /**\n         * variables\n         */\n        var course_list_table = $('#course-list-table'),\n            filter_form = $('#course-filter-form'),\n            submit_form = $('#filter-submit'),\n            clear_form = $('#filter-clear'),\n            form_action_url = filter_form.attr('action');\n\n        /**\n         * table pagination number click action\n        */\n        function table_pagination_number_click() {\n            $('#course-list-table nav ul li a').click(function () {\n                var submissionLink = $(this).attr(\"href\");\n                getXMLHttpRequestData(submissionLink);\n                return false;\n            });\n        }\n\n        /**\n         * table header sort click action\n        */\n        function table_header_sort_click() {\n            $('#course-list-table .skl-courses-table thead th a').click(function () {\n                var header_sort_url = $(this).attr(\"href\");\n                var form_data = filter_form.serialize();\n                var submissionLink = header_sort_url + '&' + form_data;\n                getXMLHttpRequestData(submissionLink);\n                show_clear_form_btn(form_data);\n                return false;\n            });\n        }\n\n        /**\n         * apply filter form submit click action\n        */\n        function submit_form_click() {\n            submit_form.click(function () {\n                var form_data = filter_form.serialize();\n                var submissionLink = form_action_url + '?' + form_data + '&treset=1';\n                var form_data_each = form_data.split('&');\n                $.each(form_data_each, function (index, value) {\n                    if ((value.split('='))[1]) {\n                        var response_obj = getXMLHttpRequestData(submissionLink);\n                        response_obj.done(function () {\n                            clear_form.removeClass('skilllab_hide');\n                        });\n                    }\n                });\n            });\n        }\n\n        /**\n         * clear filter click action\n        */\n        function clear_form_click() {\n            clear_form.click(function () {\n                filter_form[0].reset();\n                $('#search_input').val('');\n                var submissionLink = form_action_url + '?treset=1';\n                var response_obj = getXMLHttpRequestData(submissionLink);\n                response_obj.done(function () {\n                    clear_form.addClass('skilllab_hide');\n                });\n            });\n        }\n\n        /**\n         * track course_category change on filter\n         * then change add course category id\n        */\n        function track_course_category() {\n            $('#course-category-filter').on(\"change\", function () {\n                var new_category = $('#course-category-filter').val();\n                var add_course_link = $('#btn-add-course').attr('href');\n                if (new_category) {\n                    add_course_link = add_course_link.split('category')[0] + 'category=' + new_category;\n                    $('#btn-add-course').attr('href', add_course_link);\n                } else {\n                    add_course_link = add_course_link.split('category')[0] + 'category=0';\n                    $('#btn-add-course').attr('href', add_course_link);\n                }\n            });\n        }\n\n        /**\n         * get server response\n         * @param {URL} submissionLink\n         * @returns\n         */\n        function getXMLHttpRequestData(submissionLink) {\n            course_list_table.css('opacity', '0.6');\n            var get_response = $.post(submissionLink + '&table_only=true', '', function (data, status) {\n                if (status === 'success') {\n                    // // var htmlDoc = $(get_response.responseText);\n                    // var htmlDoc = $(data);\n                    // window.console.log(htmlDoc);\n                    // var html_data = htmlDoc.find('#course-list-table').html();\n                    // window.console.log(submissionLink + '&table_only=true');\n                    var html_data = data;\n                    course_list_table.html(html_data);\n                    window.history.replaceState(\"\", \"url\", submissionLink);\n                } else {\n                    window.console.log('!!! error on loading course list table ... ');\n                }\n            });\n            get_response.fail(function () {\n                const failed_data = \"<p class='failed-to-load'>Fail on loading data try again.</p>\";\n                course_list_table.html(failed_data);\n            });\n            get_response.done(function () {\n                course_list_table.css('opacity', '1');\n                single_clear_filter_item();\n                table_header_sort_click();\n                table_pagination_number_click();\n            });\n            return get_response;\n        }\n\n        /**\n         * check if the form has at least one value or not\n         * then show or hide clear form btn\n         * @param {JSON} form_data\n         */\n        function show_clear_form_btn(form_data) {\n            var form_data_each = form_data.split('&');\n            var check = false;\n            $.each(form_data_each, function (index, value) {\n                if ((value.split('='))[1]) {\n                    check = true;\n                }\n            });\n            if (check) {\n                clear_form.removeClass('skilllab_hide');\n            } else {\n                clear_form.addClass('skilllab_hide');\n            }\n            return check;\n        }\n\n        /**\n         *\n         */\n        function single_clear_filter_item() {\n            const clear_filter_item = $('.clear-filter-item');\n            const filter_form = $('#course-filter-form');\n\n            clear_filter_item.click(function () {\n                var data_id = ($(this).parent()).attr('data-id');\n                if ($('#' + data_id).attr('type') == \"checkbox\") {\n                    $('#' + data_id).prop(\"checked\", false);\n                } else {\n                    $('#' + data_id).val('');\n                }\n                var form_data = filter_form.serialize();\n                var submissionLink = form_action_url + '?' + form_data + '&treset=1';\n\n                if (show_clear_form_btn(form_data)) {\n                    getXMLHttpRequestData(submissionLink);\n                } else {\n                    getXMLHttpRequestData(form_action_url + '?treset=1');\n                }\n            });\n        }\n\n\n        /**\n         *\n         */\n        function search_enter() {\n            $('#search_input').keypress(function (event) {\n                var keycode = (event.keyCode ? event.keyCode : event.which);\n                if (keycode == '13') {\n                    var form_data = filter_form.serialize();\n                    var submissionLink = form_action_url + '?' + form_data + '&treset=1';\n                    var form_data_each = form_data.split('&');\n                    $.each(form_data_each, function (index, value) {\n                        if ((value.split('='))[1]) {\n                            var response_obj = getXMLHttpRequestData(submissionLink);\n                            response_obj.done(function () {\n                                clear_form.removeClass('skilllab_hide');\n                            });\n\n                        }\n                    });\n                    return false;\n                }\n            });\n        }\n\n\n        return {\n            init: function () {\n                // pagination page number link click\n                table_pagination_number_click();\n\n                // table head link sort click\n                table_header_sort_click();\n\n                // perform submit apply filter action on click\n                submit_form_click();\n\n                // perform clear filter action on click\n                clear_form_click();\n\n                // change course category on change\n                track_course_category();\n\n                // single filter item clear\n                single_clear_filter_item();\n\n                search_enter();\n\n            }\n        };\n\n    }\n);\n"],"names":["define","$","course_list_table","filter_form","submit_form","clear_form","form_action_url","attr","table_pagination_number_click","click","getXMLHttpRequestData","this","table_header_sort_click","header_sort_url","form_data","serialize","show_clear_form_btn","submissionLink","css","get_response","post","data","status","html_data","html","window","history","replaceState","console","log","fail","done","single_clear_filter_item","form_data_each","split","check","each","index","value","removeClass","addClass","clear_filter_item","data_id","parent","prop","val","init","reset","on","new_category","add_course_link","keypress","event","keyCode","which"],"mappings":"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"}